General comments
================
* Generic circuit that can be used to turn a unknown <$200 tube off eBay into a functioning RGA
* Make it flexible, software-define as much as possible
* Electron multipliers are not supported
* Modular design: mainboard + rod drive module
* Rod drive module options:
  * variable amplitude (resonant transformer)
  * variable frequency (linear amplifier)
* Similar galvanic isolation as ionpak

Mainboard components
====================
* Ethernet and 12V input connectors
* Screw terminals to RGA: GND, 3x plates, 2x filament
* Shielded connector (e.g. SMA) to RGA Faraday cup
* MCU TM4C1294KCPDT
* Symmetric HV flyback
* Filament flyback
* 4x bias amps (DC)
* Electron emission current probe
* TIA

Rod drive module/mainboard signals
==================================
* +/-5V
* +3.3V
* +12V (used in VA module to drive primary of RF transformer) - galvanic isolation may be problematic
* Symmetric HV (used in VF module for amps, and in VA module for DC bias)
* DDS interface (e.g. SPI) for VF module
* Carrier square wave (if generated by MCU) for VA module
* DC/RF amplitude controls, e.g. SPI DAC for VA module and PWM for VF module
* Signals for MOSFET gate capacitance compensation (VA module)
* Error (fault) feedback
* Module identification signal

Rod drive module/RGA signals
============================
* GND, Rods 1/3, Rods 2/4
* Need to keep connections short to reduce EMI
* Shielding?

Symmetric HV flyback
====================
* Used to power linear amps, voltage can be imprecise
* Use MCU PWM+ADC, or flyback control IC
* Up to +/-400V
* May want variable voltage - can be lowered during degas to reduce linear amp dissipation
* Center-tapped secondary to produce positive and negative voltages at once
* Use the same transformer cores as ionpak (large one is safer, smaller one needs testing)
* Max current about 20mA, to be confirmed (check especially degas requirements)

Filament flyback
================
* Isolated flyback, exact same design as ionpak
* Filament is biased by one of the four bias amps

Bias amplifiers
===============
* High voltage DC amplifier that can both source and sink current
* Current-limited
* See Chris Ballance's (CJB) thesis "B.2 Trap DC DACs" p. 178 https://www2.physics.ox.ac.uk/sites/default/files/2011-08-15/cjbthesis_pdf_11577.pdf
* Powered by the symmetric HV flyback
* Max current 5mA, more (TBD) during degas
* During degas, HV flyback voltage can be lowered and bias voltages constrained to reduce dissipation
* RGA may not operate during degas
* Controlled by MCU PWM (required precision is modest)

TIA
===
* 0-100nA (TBC)
* Conflicting requirements: capability to detect low currents vs. scan speed
* Option 1: same design as ionpak, scan with high-sensitivity range then repeat until no saturation is detected (does amp need extra time to recover from saturation?)
* Option 2: logarithmic TIA, e.g. ADL5304. Should be fast and work safely but not very sensitive.
* Put TIA on a second module?
* Connect to MCU ADC

Emission current monitoring
===========================
* Monitor in the bias amp connected to the filament flyback, or dedicate one of the plates as anode and measure there
* Insert current sense resistor in CJB circuit before feedback, measure voltage across it with instrumentation amplifier
* Connect to MCU ADC (required precision is modest)

Variable amplitude rod drive module
===================================
* Traditional technique
* High voltage produces intense fields, might enable using the RGA as ion trap (need to check the theory using https://github.com/nist-ionstorage/electrode)
* Circuit similar to SRS RGAm.pdf description
* Use MOSFET H-bridge to produce square wave, modulate power supply to modulate amplitude
* Drive primary of resonant RF transformer through an inductor
* Micrometals -2 material provides high Q at ~2.5MHz
* Feed out-of-phase signal to compensate for MOSFET gate capacitance (calibration should be automatic and done by firmware)
* Monitor output of RF transformer using charge pump (resistor divider needs tricky compensation)
* Use two well-balanced secondaries to drive each pair of rods (same as SRS)
* Use two independent DC bias amplifiers (similar as plate drivers) to drive each pair of rods (enables biasing the whole mass filter to arbitrary potentials)
* Need to be careful about DC bias balance, RF amplitude stabilization, and maintainance of RF/DC ratio during scan

Variable frequency rod drive module
===================================
* Requires relatively modest voltages, produces less EMI, does not require tuning, might extend mass range (need to check the theory)
* DDS TBD
* Consider high-speed common-base (voltage gain) + common emitter push-pull (current gain) circuit (idea from Grzegorz Kasprowicz)
* For common-base circuit, find higher-voltage version of BCV61/BCV63 (use one of the transistor in the pair to bias the base of the other one)
* For push-pull transistors, consider CRT drive devices made by NTE e.g. NTE2508/NTE2509
* Check circuits from Tektronix electrostatic deflection systems, current feedback amps
* Integrated CRT cathode drivers are obsolete and difficult to buy, should not be used.
* Apex op-amps are very expensive and do not work correctly, should not be used.
